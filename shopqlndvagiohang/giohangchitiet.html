<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Qu·∫£n L√Ω Gi·ªè H√†ng Chi Ti·∫øt</title>
  <link rel="icon" type="image/jpg" href="logo160s.jpg">
  <link rel="stylesheet" href="style_qlnd.css">
</head>
<body>
  <div class="container">
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="admin-info">
        <img src="·∫£nh ƒë·∫°i di·ªán trang ch·ªß..jpg" alt="Admin">
        <h3>Qu·∫£n tr·ªã vi√™n</h3>
      </div>
      <nav>
        <a href="QLND.HTML">üë• Qu·∫£n l√Ω ng∆∞·ªùi d√πng</a>
        <a href="GioHang.HTML">üõí Gi·ªè h√†ng</a>
        <a href="GioHangChiTiet.HTML" class="active">üì¶ Gi·ªè h√†ng chi ti·∫øt</a>
      </nav>
    </div>

    <!-- N·ªôi dung ch√≠nh -->
    <main class="content">
      <h1>Qu·∫£n L√Ω Gi·ªè H√†ng Chi Ti·∫øt</h1>

      <div class="actions">
        <button class="btn-add" id="btnAddDetail">‚ûï Th√™m chi ti·∫øt gi·ªè h√†ng</button>
        <div class="search">
          <input type="search" id="searchDetail" placeholder="T√¨m ki·∫øm chi ti·∫øt...">
          <button id="btnSearchDetail">üîç</button>
        </div>
      </div>

      <div class="user-table">
        <table id="detailTable">
          <thead>
            <tr>
              <th>ID_GHCT</th>
              <th>ID_GH</th>
              <th>ID S·∫£n Ph·∫©m</th>
              <th>T√™n S·∫£n Ph·∫©m</th>
              <th>S·ªë L∆∞·ª£ng</th>
              <th>M√†u S·∫Øc</th>
              <th>K√≠ch Th∆∞·ªõc</th>
              <th>Thao T√°c</th>
            </tr>
          </thead>
          <tbody>
<!---D·ªØ li·ªáu c√≥ th·ªÉ truy xu·∫•t th√™m php-->

          </tbody>
        </table>
      </div>

      <div style="margin-top:20px;">
        <button class="btn-save" onclick="goBack()">‚¨Ö Quay l·∫°i Gi·ªè H√†ng</button>
      </div>
    </main>
  </div>

  <!-- Modal th√™m -->
  <div class="modal" id="detailModal">
    <div class="modal-content">
      <h2>Th√™m Chi Ti·∫øt Gi·ªè H√†ng</h2>
      <input type="number" id="idGH" placeholder="ID Gi·ªè H√†ng">
      <input type="text" id="idSP" placeholder="ID S·∫£n Ph·∫©m">
      <input type="text" id="tenSP" placeholder="T√™n S·∫£n Ph·∫©m">
      <input type="number" id="soLuong" placeholder="S·ªë L∆∞·ª£ng">
      <input type="text" id="mauSac" placeholder="M√†u S·∫Øc">
      <input type="text" id="kichThuoc" placeholder="K√≠ch Th∆∞·ªõc">
      <div class="modal-buttons">
        <button class="btn-save" id="saveDetail">L∆∞u</button>
        <button class="btn-cancel" id="cancelDetail">H·ªßy</button>
      </div>
    </div>
  </div>

  <!-- JavaScript -->
  <script>
    let details = JSON.parse(localStorage.getItem("details")) || [];
    const id_GH = localStorage.getItem("currentCart") || "";

    const tableBody = document.querySelector("#detailTable tbody");
    const modal = document.getElementById("detailModal");
    const saveBtn = document.getElementById("saveDetail");
    const cancelBtn = document.getElementById("cancelDetail");
    const addBtn = document.getElementById("btnAddDetail");
    const searchInput = document.getElementById("searchDetail");

    function render(data) {
      tableBody.innerHTML = "";
      if (data.length === 0) {
        tableBody.innerHTML = `<tr><td colspan="8" style="text-align:center;">Ch∆∞a c√≥ chi ti·∫øt gi·ªè h√†ng n√†o</td></tr>`;
        return;
      }
      data.forEach(d => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${d.id_GHCT}</td>
          <td>${d.id_GH}</td>
          <td>${d.id_SP}</td>
          <td>${d.ten_San_Pham}</td>
          <td>${d.so_Luong}</td>
          <td>${d.mau_Sac}</td>
          <td>${d.kich_Thuoc}</td>
          <td><button class="btn-delete" onclick="deleteDetail(${d.id_GHCT})">‚ùå</button></td>
        `;
        tableBody.appendChild(tr);
      });
    }

    addBtn.onclick = () => modal.classList.add("active");
    cancelBtn.onclick = () => modal.classList.remove("active");

    saveBtn.onclick = () => {
      const idGH = document.getElementById("idGH").value.trim();
      const idSP = document.getElementById("idSP").value.trim();
      const tenSP = document.getElementById("tenSP").value.trim();
      const soLuong = document.getElementById("soLuong").value.trim();
      const mauSac = document.getElementById("mauSac").value.trim();
      const kichThuoc = document.getElementById("kichThuoc").value.trim();

      if (!idGH || !idSP || !tenSP || !soLuong) {
        alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!");
        return;
      }

      const newDetail = {
        id_GHCT: details.length ? Math.max(...details.map(d => d.id_GHCT)) + 1 : 1,
        id_GH: idGH,
        id_SP: idSP,
        ten_San_Pham: tenSP,
        so_Luong: soLuong,
        mau_Sac: mauSac,
        kich_Thuoc: kichThuoc
      };

      details.push(newDetail);
      localStorage.setItem("details", JSON.stringify(details));
      render(details.filter(d => !id_GH || d.id_GH == id_GH));
      modal.classList.remove("active");
    };

    function deleteDetail(id_CT) {
      details = details.filter(d => d.id_GHCT != id_CT);
      localStorage.setItem("details", JSON.stringify(details));
      render(details.filter(d => !id_GH || d.id_GH == id_GH));
    }

    function goBack() {
      window.location.href = "GioHang.HTML";
    }

    searchInput.addEventListener("input", e => {
      const keyword = e.target.value.toLowerCase();
      const filtered = details.filter(d =>
        d.id_GH.toString().includes(keyword) ||
        d.id_SP.toLowerCase().includes(keyword) ||
        d.ten_San_Pham.toLowerCase().includes(keyword)
      );
      render(filtered);
    });

    render(details.filter(d => !id_GH || d.id_GH == id_GH));
  </script>
</body>
</html>
