<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Qu·∫£n l√Ω ng∆∞·ªùi d√πng.">
  <meta name="keywords" content="qu·∫£n l√Ω ng∆∞·ªùi d√πng">
  <title>Qu·∫£n L√Ω Ng∆∞·ªùi D√πng</title>
  <link rel="icon" type="image/jpg" href="logo160s.jpg">
  <link rel="stylesheet" href="style_qlnd.css">
</head>
<body>
  <div class="container">
    <div class="sidebar">
      <div class="admin-info">
        <img src="·∫£nh ƒë·∫°i di·ªán trang ch·ªß..jpg" alt="Admin">
        <h3>Qu·∫£n tr·ªã vi√™n</h3>
      </div>
      <nav>
        <a href="QLND.HTML" class="active">üë• Qu·∫£n l√Ω ng∆∞·ªùi d√πng</a>
        <a href="GioHang.HTML">üõí Gi·ªè h√†ng</a>
      </nav>
    </div>

    <main class="content">
      <h1>Qu·∫£n L√Ω Ng∆∞·ªùi D√πng</h1>

      <div class="actions">
        <button class="btn-add" id="btnAddUser">‚ûï Th√™m ng∆∞·ªùi d√πng m·ªõi</button>
        <div class="search">
          <input type="search" id="searchInput" placeholder="T√¨m ki·∫øm ng∆∞·ªùi d√πng...">
          <button id="btnSearch">üîç</button>
        </div>
      </div>

      <div class="user-table">
        <table id="userTable">
          <thead>
            <tr>
              <th>ID</th>
              <th>T√™n ng∆∞·ªùi d√πng</th>
              <th>M·∫≠t kh·∫©u</th>
              <th>H·ªç t√™n</th>
              <th>Email</th>
              <th>ƒê·ªãa ch·ªâ</th>
              <th>S·ªë ƒëi·ªán tho·∫°i</th>
              <th>Vai tr√≤</th>
              <th>Tr·∫°ng th√°i</th>
              <th>Thao t√°c</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </main>
  </div>

  <!-- Modal th√™m ng∆∞·ªùi d√πng -->
  <div class="modal" id="userModal">
    <div class="modal-content">
      <h2>Th√™m ng∆∞·ªùi d√πng</h2>
      <input type="text" id="username" placeholder="T√™n ng∆∞·ªùi d√πng">
      <input type="password" id="password" placeholder="M·∫≠t kh·∫©u">
      <input type="text" id="fullname" placeholder="H·ªç v√† t√™n">
      <input type="email" id="email" placeholder="Email">
      <input type="text" id="address" placeholder="ƒê·ªãa ch·ªâ">
      <input type="text" id="phone" placeholder="S·ªë ƒëi·ªán tho·∫°i">
      <input type="text" id="role" placeholder="Vai tr√≤ (VD: admin, user)">
      <input type="text" id="status" placeholder="Tr·∫°ng th√°i (VD: ho·∫°t ƒë·ªông, kh√≥a)">
      <div class="modal-buttons">
        <button class="btn-save" id="saveUser">L∆∞u</button>
        <button class="btn-cancel" id="cancelModal">H·ªßy</button>
      </div>
    </div>
  </div>

  <!-- ‚úÖ JavaScript -->
 <script>
  // D·ªØ li·ªáu m·∫´u (ch·∫°y l·∫ßn ƒë·∫ßu n·∫øu localStorage tr·ªëng)
  const sampleUsers = [
    { id: 1, username: "admin", password: "123", fullname: "Qu·∫£n tr·ªã vi√™n", email: "admin@gmail.com", address: "H√† N·ªôi", phone: "0909123456", role: "admin", status: "ho·∫°t ƒë·ªông" }
  ];

  // L·∫•y d·ªØ li·ªáu t·ª´ localStorage ho·∫∑c d√πng d·ªØ li·ªáu m·∫´u
  let users = JSON.parse(localStorage.getItem('users')) || sampleUsers;

  const userTable = document.querySelector("#userTable tbody");
  const btnAddUser = document.getElementById("btnAddUser");
  const modal = document.getElementById("userModal");
  const saveUser = document.getElementById("saveUser");
  const cancelModal = document.getElementById("cancelModal");
  const searchInput = document.getElementById("searchInput");

  // H√†m hi·ªÉn th·ªã b·∫£ng
  function renderTable(data) {
    userTable.innerHTML = "";
    if (data.length === 0) {
      userTable.innerHTML = `<tr><td colspan="10" style="text-align:center;">Ch∆∞a c√≥ ng∆∞·ªùi d√πng n√†o</td></tr>`;
      return;
    }

    data.forEach(u => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${u.id}</td>
        <td>${u.username}</td>
        <td>${u.password}</td>
        <td>${u.fullname || ''}</td>
        <td>${u.email}</td>
        <td>${u.address || ''}</td>
        <td>${u.phone || ''}</td>
        <td>${u.role}</td>
        <td>${u.status}</td>
        <td>
          <button class="btn-edit" onclick="editUser(${u.id})">‚úèÔ∏è</button>
          <button class="btn-delete" onclick="deleteUser(${u.id})">‚ùå</button>
        </td>
      `;
      userTable.appendChild(row);
    });
  }

  // X√≥a ng∆∞·ªùi d√πng
  window.deleteUser = function(id) {
    if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ng∆∞·ªùi d√πng n√†y?")) {
      users = users.filter(u => u.id !== id);
      localStorage.setItem('users', JSON.stringify(users));
      renderTable(users);
    }
  };

  // S·ª≠a ng∆∞·ªùi d√πng
  window.editUser = function(id) {
    const user = users.find(u => u.id === id);
    if (user) {
      document.getElementById("username").value = user.username;
      document.getElementById("password").value = user.password;
      document.getElementById("fullname").value = user.fullname;
      document.getElementById("email").value = user.email;
      document.getElementById("address").value = user.address;
      document.getElementById("phone").value = user.phone;
      document.getElementById("role").value = user.role;
      document.getElementById("status").value = user.status;
      saveUser.dataset.editId = id;
      modal.classList.add("active");
    }
  };

  // M·ªü modal th√™m
  btnAddUser.onclick = () => {
    saveUser.dataset.editId = ""; // reset
    document.querySelectorAll(".modal-content input").forEach(i => i.value = "");
    modal.classList.add("active");
  };

  cancelModal.onclick = () => modal.classList.remove("active");

  // L∆∞u ng∆∞·ªùi d√πng
  saveUser.onclick = () => {
    const editId = saveUser.dataset.editId;
    const username = document.getElementById("username").value.trim();
    const password = document.getElementById("password").value.trim();
    const fullname = document.getElementById("fullname").value.trim();
    const email = document.getElementById("email").value.trim();
    const address = document.getElementById("address").value.trim();
    const phone = document.getElementById("phone").value.trim();
    const role = document.getElementById("role").value.trim() || 'user';
    const status = document.getElementById("status").value.trim() || 'ho·∫°t ƒë·ªông';

    if (!username || !password || !email) {
      alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß T√™n, M·∫≠t kh·∫©u v√† Email!");
      return;
    }

    // N·∫øu l√† ch·ªânh s·ª≠a
    if (editId) {
      const idx = users.findIndex(u => u.id == editId);
      if (idx !== -1) {
        users[idx] = { ...users[idx], username, password, fullname, email, address, phone, role, status };
      }
    } else {
      // Th√™m m·ªõi
      const newUser = {
        id: users.length ? Math.max(...users.map(u => u.id)) + 1 : 1,
        username, password, fullname, email, address, phone, role, status
      };
      users.push(newUser);
    }

    // C·∫≠p nh·∫≠t localStorage + hi·ªÉn th·ªã l·∫°i b·∫£ng
    localStorage.setItem('users', JSON.stringify(users));
    renderTable(users);

    // ƒê√≥ng modal
    modal.classList.remove("active");
  };

  // T√¨m ki·∫øm ng∆∞·ªùi d√πng
  searchInput.addEventListener("input", e => {
    const keyword = e.target.value.toLowerCase();
    const filtered = users.filter(u =>
      u.username.toLowerCase().includes(keyword) ||
      (u.fullname && u.fullname.toLowerCase().includes(keyword)) ||
      u.email.toLowerCase().includes(keyword) ||
      u.role.toLowerCase().includes(keyword) ||
      u.status.toLowerCase().includes(keyword)
    );
    renderTable(filtered);
  });

  // Khi t·∫£i trang th√¨ hi·ªÉn th·ªã d·ªØ li·ªáu
  renderTable(users);
</script>
</body>
</html>